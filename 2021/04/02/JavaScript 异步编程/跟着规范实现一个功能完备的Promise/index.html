<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/cipher.ico">
  <link rel="icon" type="image/png" href="/img/cipher.ico">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="cipher">
  <meta name="keywords" content="">
  <title>è·Ÿç€è§„èŒƒå®ç°ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„Promise - Cipher</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_fmb4a04yx8h.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">




<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Cipher</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">
              <i class="iconfont icon-home-fill"></i>
              é¦–é¡µ</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">
              <i class="iconfont icon-archive-fill"></i>
              å½’æ¡£</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">
              <i class="iconfont icon-category-fill"></i>
              åˆ†ç±»</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">
              <i class="iconfont icon-tags-fill"></i>
              æ ‡ç­¾</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">
              <i class="iconfont icon-user-fill"></i>
              å…³äº</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/docsmall/article.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.1)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
                è·Ÿç€è§„èŒƒå®ç°ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„Promise
              
            </span>

            
              
                <div class="mt-3 post-meta">
                  <i class="iconfont icon-date-fill" aria-hidden="true"></i>
                  <time datetime="2021-04-02 00:00">
                    2021å¹´4æœˆ2æ—¥ å‡Œæ™¨
                  </time>
                </div>
              

              <div class="mt-1">
                
                  
                  <span class="post-meta mr-2">
                    <i class="iconfont icon-chart"></i>
                    2.5k å­—
                  </span>
                

                
                  
                  <span class="post-meta mr-2">
                      <i class="iconfont icon-clock-fill"></i>
                    
                    
                    37
                     åˆ†é’Ÿ
                  </span>
                

                
              </div>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <pre><code class="hljs mercury">ä¸€ç›´ä»¥æ¥ï¼Œå¯¹äº <span class="hljs-keyword">promise</span>ï¼ŒåªçŸ¥é“å¦‚ä½•ä½¿ç”¨ï¼Œå…¶å†…éƒ¨çš„è¿ä½œæœºåˆ¶å´ä¸€ç›´ä¸å¾—è€ŒçŸ¥ã€‚ä¸ºäº†è®©è‡ªå·±ç”¨å¾—å®‰å¿ƒï¼Œå†³å®šè·Ÿç€è§„èŒƒå»äº†è§£åº•å±‚çš„åŸç†ï¼Œå¹¶æ‰‹å†™ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„ MyPromise.</code></pre>

<h4 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h4><ul>
<li>promise æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€…å‡½æ•°ï¼Œæ‹¥æœ‰ then æ–¹æ³•</li>
<li>thenable å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ‹¥æœ‰ then æ–¹æ³•çš„å¯¹è±¡æˆ–å‡½æ•°</li>
<li>value æ˜¯ä¸€ä¸ªåˆæ³•çš„ JavaScriptå€¼</li>
<li>reason ç”¨æ¥è¡¨ç¤º promise æ‹’ç»çš„åŸå› </li>
</ul>
<h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul>
<li>promise åˆå§‹çŠ¶æ€ä¸º pendingï¼Œå¯ä»¥è½¬å˜æˆ fulfilled æˆ–è€… rejected</li>
<li>å¦‚æœçŠ¶æ€æ˜¯ fulfilledï¼Œåˆ™ä¸èƒ½è½¬å˜ä¸º rejected æˆ–è€… pendingã€‚rejected åŒç†ã€‚</li>
</ul>
<h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>ä¸‹é¢å¼€å§‹å°è¯•ç¬¬ä¸€ç‰ˆï¼š</p>
<p>å› ä¸ºå¹³æ—¶æ˜¯è¿™æ ·ç”¨çš„ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
    <span class="hljs-comment">// do something</span>
    resolve(<span class="hljs-string">'xxx'</span>)
&#125;)</code></pre>

<p>äºæ˜¯é¦–å…ˆåˆ›å»ºä¸€ä¸ª promise æ„é€ å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªæ–¹æ³• executor ä½œä¸ºå‚æ•°, åœ¨å†…éƒ¨ç›´æ¥æ‰§è¡Œï¼Œå¹¶ä¸”ä¼ å…¥ä¸¤ä¸ªæ–¹æ³•ä»¥ä¾›ä½¿ç”¨è€…ä½¿ç”¨ã€‚</p>
<pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MyPromise</span>(<span class="hljs-params">executor</span>) </span>&#123;
    <span class="hljs-keyword">const</span> resolve = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;&#125;
    <span class="hljs-keyword">const</span> reject = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;&#125;
    
    executor(resolve, reject);
&#125;</code></pre>

<p>å¦‚æœè°ƒç”¨ resolve æ–¹æ³•ï¼Œåˆ™ä¼šå°† Promiseå®ä¾‹ çŠ¶æ€è½¬å˜æˆ fulfilledï¼Œå¦‚æœè°ƒç”¨ reject æ–¹æ³•ï¼Œåˆ™ä¼šå°† Promise å®ä¾‹çŠ¶æ€è½¬å˜æˆ rejectedã€‚æ‰€ä»¥æ¥ä¸‹æ¥ç»™ MyPromise æ„é€ å‡½æ•°æ·»åŠ ç›¸åº”å±æ€§ï¼Œå¹¶å®ç° resolve å’Œ rejectã€‚</p>
<pre><code class="hljs kotlin">function MyPromise(executor) &#123;
    <span class="hljs-keyword">this</span>.status = <span class="hljs-string">'pending'</span>;
    <span class="hljs-keyword">this</span>.value = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.reason = <span class="hljs-literal">null</span>;
    
    <span class="hljs-keyword">const</span> resolve = (value) =&gt; &#123;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === <span class="hljs-string">'pending'</span>) &#123;
            <span class="hljs-keyword">this</span>.status = <span class="hljs-string">'fulfilled'</span>;
            <span class="hljs-keyword">this</span>.value = value;
        &#125;
        
    &#125;
    <span class="hljs-keyword">const</span> reject = (reason) =&gt; &#123;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === <span class="hljs-string">'pending'</span>) &#123;
            <span class="hljs-keyword">this</span>.status = <span class="hljs-string">'rejected'</span>;
            <span class="hljs-keyword">this</span>.reason = reason;
        &#125;
    &#125;
    
    executor(resolve, reject);
&#125;</code></pre>

<p>æ„é€ å‡½æ•°å»ºé€ å®Œæ¯•ï¼Œç°åœ¨æ¥å¤„ç†æœ€ä¸»è¦çš„éƒ¨åˆ† then æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯è§„èŒƒç»™å‡ºè¯¦ç»†æ ‡å‡†çš„ä¸€å—å„¿ã€‚</p>
<pre><code class="hljs actionscript"><span class="hljs-comment">// å¯ä»¥æ¥æ”¶ä¸¤ä¸ªæ–¹æ³•ä½œä¸ºå‚æ•°, åœ¨å†…éƒ¨å¯ä»¥æ ¹æ® MyPromise å®ä¾‹çš„çŠ¶æ€è¿›è¡Œç›¸åº”çš„æ“ä½œ</span>
MyPromise.prototype.then = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(onFulfilled, onRejected)</span> </span>&#123;
    
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === <span class="hljs-string">'pending'</span>) &#123;
        
    &#125;
    
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === <span class="hljs-string">'fulfilled'</span>) &#123;
        
    &#125;
    
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === <span class="hljs-string">'rejected'</span>) &#123;
        
    &#125;
&#125;</code></pre>

<p>å½“ then æ‰§è¡Œçš„æ—¶å€™ï¼Œå¦‚æœ status æ˜¯ fulfilled æˆ–è€… rejected çŠ¶æ€ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œ onFulfilled æˆ–è€… onRejected æ–¹æ³•ï¼Œä½†å¦‚æœä¾ç„¶è¿˜æ˜¯ pendingï¼Œéœ€è¦å°†è¿™äº›æ‰§è¡Œæ“ä½œè¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°çŠ¶æ€ä¸æ˜¯ pendingï¼Œè¿™æ—¶å°±éœ€è¦ç”¨å›è°ƒé˜Ÿåˆ—å»å­˜å‚¨æ‰§è¡Œæ“ä½œï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs kotlin">function MyPromise(executor) &#123;
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">this</span>.onFulfilledStack = [];
    <span class="hljs-keyword">this</span>.onRejectedStack = [];
    
    <span class="hljs-keyword">const</span> resolve = (value) =&gt; &#123;
        <span class="hljs-keyword">this</span>.status = <span class="hljs-string">'fulfilled'</span>;
        <span class="hljs-keyword">this</span>.value = value;
        <span class="hljs-comment">// æ‰§è¡Œå›è°ƒ</span>
        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">this</span>.onFulfilledStack.length &gt; <span class="hljs-number">0</span>) &#123;
            <span class="hljs-keyword">this</span>.onFulfilledStack.shift()(<span class="hljs-keyword">this</span>.value);
        &#125;
    &#125;
    <span class="hljs-keyword">const</span> reject = (reason) =&gt; &#123;
        <span class="hljs-keyword">this</span>.status = <span class="hljs-string">'rejected'</span>;
        <span class="hljs-keyword">this</span>.reason = reason;
        <span class="hljs-comment">// æ‰§è¡Œå›è°ƒ</span>
        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">this</span>.onRejectedStack.length &gt; <span class="hljs-number">0</span>) &#123;
            <span class="hljs-keyword">this</span>.onRejectedStack.shift()(<span class="hljs-keyword">this</span>.reason);
        &#125;
    &#125;
    
    executor(resolve, reject);
&#125;

MyPromise.prototype.then = function(onFulfilled, onRejected) &#123;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === <span class="hljs-string">'pending'</span>) &#123;
        <span class="hljs-keyword">this</span>.onFulfilledStack.push(() =&gt; &#123;
            onFulfilled(<span class="hljs-keyword">this</span>.value);
        &#125;)
        <span class="hljs-keyword">this</span>.onRejectedStack.push(() =&gt; &#123;
            onRejected(<span class="hljs-keyword">this</span>.reason)
        &#125;)
    &#125;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === <span class="hljs-string">'fulfilled'</span>) &#123;
        onFulfilled(<span class="hljs-keyword">this</span>.value);
    &#125;
    
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === <span class="hljs-string">'rejected'</span>) &#123;
        onRejected(<span class="hljs-keyword">this</span>.reason)
    &#125;
&#125;</code></pre>

<p>then æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ª promiseï¼Œå› æ­¤å¯¹ then æ–¹æ³•ç»§ç»­æ”¹é€ ï¼š</p>
<pre><code class="hljs javascript">MyPromise.prototype.then = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">onFulfilled, onRejected</span>) </span>&#123;
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
        
    &#125;)
&#125;</code></pre>

<p>åˆ°è¿™é‡Œå°±è¦æ€è€ƒä¸€ä¸‹ï¼Œthen æ–¹æ³•ä¸ºä»€ä¹ˆè¦è¿”å›ä¸€ä¸ª promiseï¼Ÿ åŸå› æ˜¯æ¯ä¸€ä¸ª promise éƒ½ä¼šæœ‰ä¸€ä¸ª then æ–¹æ³•ï¼Œè€Œå¦‚æœ then æ–¹æ³•ä¹Ÿè¿”å›ä¸€ä¸ª promiseï¼Œé‚£ä¹ˆè¿™ä¸ª then ä¹Ÿä¼šæœ‰ä¸€ä¸ª then æ–¹æ³•ï¼Œäºæ˜¯å¯ä»¥åƒä¸‹æ–¹ä»£ç ä¸€æ ·é“¾å¼è°ƒç”¨ ï¼š</p>
<pre><code class="hljs coffeescript"><span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function"><span class="hljs-params">(resolve, reject)</span> =&gt;</span> &#123;
    resolve(<span class="hljs-string">'success'</span>)
&#125;).<span class="hljs-keyword">then</span>().<span class="hljs-keyword">then</span>()</code></pre>

<p>ä½†è¿˜æœ‰ä¸ªåŸå› ã€‚æˆ‘ä»¬ä¸ä»…å¯ä»¥åƒä¸Šæ–¹ä¸€æ · resolve ä¸€ä¸ªåŸºæœ¬å€¼ï¼Œä¹Ÿå¯ä»¥ resolve ä¸€ä¸ª promiseï¼Œè€Œè¿™ä¸ª promise çš„çŠ¶æ€çš„æ”¹å˜æ˜¯å°šæœªæ”¹å˜çš„ï¼Œå› æ­¤å¯ä»¥å°†è¿™ä¸ª promise æ”¾è¿› then è¿”å›çš„è¿™ä¸ª promise å†…å»ç­‰å¾…çŠ¶æ€æ”¹å˜</p>
<pre><code class="hljs coffeescript"><span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function"><span class="hljs-params">(resolve, reject)</span> =&gt;</span> &#123;
    resolve(<span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function"><span class="hljs-params">(_resolve, _reject)</span> =&gt;</span> &#123;
        setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
            _resolve(<span class="hljs-string">'success'</span>)
        &#125;, <span class="hljs-number">2000</span>)
    &#125;))
&#125;).<span class="hljs-keyword">then</span>().<span class="hljs-keyword">then</span>()
MyPromsise.prototype.<span class="hljs-keyword">then</span> = function(onFulfilled, onRejected) &#123;
    let _promise = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">return</span> _promise = <span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function"><span class="hljs-params">(resolve, reject)</span> =&gt;</span> &#123;
        <span class="hljs-regexp">//</span> å› ä¸º onFulfilled(<span class="hljs-keyword">this</span>.value) å’Œ onRejected(<span class="hljs-keyword">this</span>.reason) å¯èƒ½è¿”å›ä¸€ä¸ª thenableï¼Œå› æ­¤éœ€è¦å°†ä¸‹æ–¹ä»£ç ç§»å…¥æ–° promiseå†…éƒ¨å»æ‰§è¡Œ
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === <span class="hljs-string">'pending'</span>) &#123;
            <span class="hljs-keyword">this</span>.onFulfilledStack.push(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
                onFulfilled(<span class="hljs-keyword">this</span>.value);
            &#125;)
            <span class="hljs-keyword">this</span>.onRejectedStack.push(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
                onRejected(<span class="hljs-keyword">this</span>.reason)
            &#125;)
        &#125;
    
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === <span class="hljs-string">'fulfilled'</span>) &#123;
            onFulfilled(<span class="hljs-keyword">this</span>.value);
        &#125;
        
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === <span class="hljs-string">'rejected'</span>) &#123;
            onRejected(<span class="hljs-keyword">this</span>.reason)
        &#125;
    &#125;)
    
&#125;</code></pre>

<p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œæˆ‘åœ¨å†…éƒ¨ç›´æ¥è°ƒç”¨ onFulfilled å’Œ onRejectedï¼Œä½†å´æ²¡æœ‰å¯¹è¿™ä¸¤ä¸ªæ–¹æ³•ç±»å‹è¿›è¡Œé”™è¯¯å¤„ç†ï¼Œä¹Ÿå°±æ˜¯å¿…é¡»è®©å®ƒä»¬æ˜¯ functionã€‚</p>
<pre><code class="hljs javascript">MyPromsise.prototype.then = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">onFulfilled, onRejected</span>) </span>&#123;
    <span class="hljs-comment">// è®¾ç½®é»˜è®¤çš„å›è°ƒæ–¹æ³•ï¼ˆéœ€åŸæ ·è¿”å›ä¼ è¿›æ¥çš„å€¼æˆ–è€…æŠ›å‡ºåŒæ ·çš„å€¼ï¼‰ï¼Œå¯ä»¥ä¿è¯ promise ç»“æœèƒ½å¤Ÿé€ä¼ </span>
    onFulfilled = <span class="hljs-keyword">typeof</span> onFulfilled === <span class="hljs-string">'function'</span> ? onFulfilled : <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> value;
    onRejected = <span class="hljs-keyword">typeof</span> onRejected === <span class="hljs-string">'function'</span> ? onRejected : <span class="hljs-function"><span class="hljs-params">reason</span> =&gt;</span> &#123; <span class="hljs-keyword">throw</span> reason &#125;
    <span class="hljs-comment">// ...</span>
&#125;</code></pre>

<p>è¿™é‡Œæœ‰ä¸€ä¸ªå¤„ç†ï¼Œå¦‚æœ onFulfilled å’Œ onRejected ä¸æ˜¯ functionï¼Œé‚£ä¹ˆå°±å°†å®ƒä»¬èµ‹å€¼æˆæ–¹æ³•ï¼Œå¹¶ä¸”å°†æ¥æ”¶åˆ°çš„å€¼è¿›è¡Œç›¸åº”å¤„ç†ï¼šå¦‚æœæ˜¯ onFulfilledï¼Œç›´æ¥å°†å€¼ returnï¼Œå¦‚æœæ˜¯ onRejected, ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚è¿™ä¹Ÿå°±å®ç°äº† promise å€¼çš„é€ä¼ </p>
<pre><code class="hljs coffeescript"><span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function"><span class="hljs-params">(resolve, reject)</span> =&gt;</span> &#123;
    resolve(<span class="hljs-string">'success'</span>)
&#125;).<span class="hljs-keyword">then</span>().<span class="hljs-keyword">then</span>(<span class="hljs-function"><span class="hljs-params">(value)</span> =&gt;</span> &#123;
    <span class="hljs-built_in">console</span>.log(value)  <span class="hljs-regexp">//</span> success
&#125;)</code></pre>

<p>ç›®å‰ä¸ºæ­¢ï¼ŒMyPromise å·²ç»å…·å¤‡äº†å¯å®ä¾‹åŒ–ï¼Œå¯æ‰§è¡ŒåŒæ­¥ä»»åŠ¡çš„åŠŸèƒ½ã€‚ä½†æ˜¯ä¸Šè¿°ä»£ç å­˜åœ¨æœ‰ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>æ— æ³•æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡</li>
</ul>
<p>2.2.4ï¼š onFulfilled or onRejected must not be called until the execution context stack contains only platform code</p>
<p>æ„æ€æ˜¯ï¼šonFulfilled å’Œ onRejected æ–¹æ³•éœ€è¦å¼‚æ­¥æ‰§è¡Œã€‚</p>
<p>æ¥ä¸‹æ¥å¯¹ then æ–¹æ³•è¿›è¡Œè¿›ä¸€æ­¥å®Œå–„, å°†å®ƒä»¬çš„æ‰§è¡Œä¸¢å…¥åˆ°å¼‚æ­¥ç¯å¢ƒä¸­</p>
<pre><code class="hljs coffeescript">MyPromsise.prototype.<span class="hljs-keyword">then</span> = function(onFulfilled, onRejected) &#123;
    <span class="hljs-regexp">//</span> ...
    let _promise = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">return</span> _promise = <span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function"><span class="hljs-params">(resolve, reject)</span> =&gt;</span> &#123;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === <span class="hljs-string">'pending'</span>) &#123;
            setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
                <span class="hljs-keyword">this</span>.onFulfilledStack.push(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
                    onFulfilled(<span class="hljs-keyword">this</span>.value);
                &#125;)
                <span class="hljs-keyword">this</span>.onRejectedStack.push(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
                    onRejected(<span class="hljs-keyword">this</span>.reason)
                &#125;)
            &#125;)
            
        &#125;
    
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === <span class="hljs-string">'fulfilled'</span>) &#123;
            setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
                onFulfilled(<span class="hljs-keyword">this</span>.value);
            &#125;)
            
        &#125;
        
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === <span class="hljs-string">'rejected'</span>) &#123;
            setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
                onRejected(<span class="hljs-keyword">this</span>.reason)
            &#125;)
            
        &#125;
    &#125;)
    
&#125;</code></pre>

<p>2.2.7.1 If either onFulfilled or onRejected returns a value x, run the Promise Resolution Procedure [[Resolve]](promise2, x)</p>
<p>æ„æ€æ˜¯ï¼š å¯¹ onFulfilled æˆ–è€… onRejected è¿”å›çš„å€¼ x è¿›è¡Œ resolvePromise æ“ä½œï¼Œå³éœ€è¦å°† x å½“ä½œä¸€ä¸ª thenable æ¥å¯¹å¾…ï¼Œthen è¿”å›çš„ promise çš„ çŠ¶æ€éœ€è¦ x çš„çŠ¶æ€æ¥å†³å®šã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼š resolvePromise éœ€è¦ promise2 å’Œ x è¿™ä¸¤ä¸ªå‚ï¼Œä½†æ˜¯ promise2 çš„çŠ¶æ€éœ€è¦å®ƒè‡ªèº« resolve å’Œ reject å»æ”¹å˜ï¼Œå› æ­¤å°† resolve å’Œ reject ä¹Ÿå¸¦ä¸Šã€‚</p>
<p>æ”¹åŠ¨å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs reasonml"><span class="hljs-keyword">if</span> (this.status<span class="hljs-operator"> === </span>'pending') &#123;
    
    this.onFulfilledStack.push(<span class="hljs-literal">()</span> =&gt; &#123;
        set<span class="hljs-constructor">Timeout(()</span> =&gt; &#123;
            <span class="hljs-keyword">let</span> x = on<span class="hljs-constructor">Fulfilled(<span class="hljs-params">this</span>.<span class="hljs-params">value</span>)</span>;
            resolve<span class="hljs-constructor">Promise(<span class="hljs-params">_promise</span>, <span class="hljs-params">x</span>, <span class="hljs-params">resolve</span>, <span class="hljs-params">reject</span>)</span>
        &#125;)
        
    &#125;)
    this.onRejectedStack.push(<span class="hljs-literal">()</span> =&gt; &#123;
        set<span class="hljs-constructor">Timeout(()</span> =&gt; &#123;
            <span class="hljs-keyword">let</span> x = on<span class="hljs-constructor">Rejected(<span class="hljs-params">this</span>.<span class="hljs-params">reason</span>)</span>;
            resolve<span class="hljs-constructor">Promise(<span class="hljs-params">_promise</span>, <span class="hljs-params">x</span>, <span class="hljs-params">resolve</span>, <span class="hljs-params">reject</span>)</span>
        &#125;)
        
        
    &#125;)
    
&#125;

<span class="hljs-keyword">if</span> (this.status<span class="hljs-operator"> === </span>'fulfilled') &#123;
    set<span class="hljs-constructor">Timeout(()</span> =&gt; &#123;
        <span class="hljs-keyword">let</span> x = on<span class="hljs-constructor">Fulfilled(<span class="hljs-params">this</span>.<span class="hljs-params">value</span>)</span>;
        resolve<span class="hljs-constructor">Promise(<span class="hljs-params">_promise</span>, <span class="hljs-params">x</span>, <span class="hljs-params">resolve</span>, <span class="hljs-params">reject</span>)</span>
    &#125;)
    
&#125;

<span class="hljs-keyword">if</span> (this.status<span class="hljs-operator"> === </span>'rejected') &#123;
    set<span class="hljs-constructor">Timeout(()</span> =&gt; &#123;
        <span class="hljs-keyword">let</span> x = on<span class="hljs-constructor">Rejected(<span class="hljs-params">this</span>.<span class="hljs-params">reason</span>)</span>;
        resolve<span class="hljs-constructor">Promise(<span class="hljs-params">_promise</span>, <span class="hljs-params">x</span>, <span class="hljs-params">resolve</span>, <span class="hljs-params">reject</span>)</span>
    &#125;)
    
&#125;</code></pre>

<p>æ¥ä¸‹æ¥å°±æ˜¯å®ç° resolvePromise æ–¹æ³•äº†ã€‚</p>
<p>æŒ‰ç…§è§„èŒƒ 2.3 The Promise Resolution Procedureï¼Œä¸€æ­¥æ­¥å®ç°ï¼š</p>
<pre><code class="hljs reasonml"><span class="hljs-keyword">function</span> resolve<span class="hljs-constructor">Promise(<span class="hljs-params">_promise</span>, <span class="hljs-params">x</span>, <span class="hljs-params">resolve</span>, <span class="hljs-params">reject</span>)</span>&#123;
    <span class="hljs-comment">// 2.3.1 å¦‚æœ _promise å’Œ x æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œreject TypeError</span>
    <span class="hljs-keyword">if</span> (x<span class="hljs-operator"> === </span>_promise) &#123;
        return reject(<span class="hljs-keyword">new</span> <span class="hljs-constructor">TypeError(`$&#123;<span class="hljs-params">x</span>&#125; <span class="hljs-params">should</span> <span class="hljs-params">no</span> <span class="hljs-params">refer</span> <span class="hljs-params">to</span> <span class="hljs-params">the</span> <span class="hljs-params">same</span> <span class="hljs-params">object</span> <span class="hljs-params">with</span> MyPromise`)</span>)
    &#125;
    
    <span class="hljs-comment">// å½“ x æ˜¯å¯¹è±¡æˆ–è€…å‡½æ•°æ—¶ï¼š</span>
    <span class="hljs-comment">// åˆ¤æ–­ x.then æ–¹æ³•ä¸­ onFulfilled å›è°ƒæˆ–è€… onRejecetd å›è°ƒæ˜¯å¦æ‰§è¡Œè¿‡</span>
    <span class="hljs-comment">// å› ä¸ºè§„èŒƒè§„å®šï¼šå…¶ä¸­æ¯ä¸€ä¸ªå›è°ƒåªèƒ½æ‰§è¡Œä¸€æ¬¡</span>
    <span class="hljs-comment">// å½“å…¶ä¸­æŸé¡¹æ‰§è¡Œè¿‡ï¼Œå°±å°† hasCalled ç½®ä¸º true</span>
    <span class="hljs-keyword">let</span> hasCalled = <span class="hljs-literal">false</span>;
    
    <span class="hljs-keyword">if</span> (x instanceof MyPromsie) &#123;
        <span class="hljs-comment">// å¦‚æœçŠ¶æ€æ²¡æœ‰æ”¹å˜ï¼Œåˆ™éœ€è¦è°ƒç”¨ then æ–¹æ³•ï¼Œç„¶ååœ¨å†…éƒ¨è¿˜éœ€è¦å¯¹ä»¥åçš„è¿”å›å€¼è¿›è¡Œ resolvePromise </span>
        <span class="hljs-keyword">if</span> (x.status<span class="hljs-operator"> === </span>'pending') &#123;
            x.<span class="hljs-keyword">then</span>(y =&gt; &#123;
                resolve<span class="hljs-constructor">Promise(<span class="hljs-params">_promise</span>, <span class="hljs-params">y</span>, <span class="hljs-params">resolve</span>, <span class="hljs-params">reject</span>)</span>
            &#125;,<span class="hljs-function"> <span class="hljs-params">err</span> =&gt;</span> &#123;
                resolve<span class="hljs-constructor">Promise(<span class="hljs-params">_promise</span>, <span class="hljs-params">err</span>, <span class="hljs-params">resolve</span>, <span class="hljs-params">reject</span>)</span>
            &#125;)
        &#125; <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-comment">// å¦‚æœçŠ¶æ€å·²ç»æ”¹å˜ï¼Œé‚£ä¹ˆ x å°±ä¼šæœ‰ä¸€ä¸ªæ­£å¸¸å€¼ï¼Œå‡è®¾ä¸º z</span>
            <span class="hljs-comment">// æ‰§è¡Œ x.then(resolve, reject)ï¼Œä¼šç›´æ¥è°ƒç”¨ resolve(z) æˆ–è€… reject(z) ï¼š</span>
            <span class="hljs-comment">// 2.3.2.2 &amp;&amp; 2.3.2.3</span>
            x.<span class="hljs-keyword">then</span>(resolve, reject);
        &#125;
    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Object</span>.</span></span>prototype.toString.call(x)<span class="hljs-operator"> === </span>'<span class="hljs-literal">[<span class="hljs-identifier">object</span> O<span class="hljs-identifier">bject</span>]</span>'<span class="hljs-operator"> || </span>typeof x<span class="hljs-operator"> === </span>'<span class="hljs-keyword">function</span>') &#123; <span class="hljs-comment">// x æ˜¯å¯¹è±¡æˆ–è€…å‡½æ•°</span>
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-keyword">let</span> <span class="hljs-keyword">then</span> = x.<span class="hljs-keyword">then</span>;
            <span class="hljs-keyword">if</span> (typeof <span class="hljs-keyword">then</span><span class="hljs-operator"> === </span>'<span class="hljs-keyword">function</span>') &#123;
                <span class="hljs-keyword">then</span>.call(x,<span class="hljs-function"> <span class="hljs-params">y</span> =&gt;</span> &#123;
                    <span class="hljs-keyword">if</span> (hasCalled) &#123; return &#125;
                    hasCalled = <span class="hljs-literal">true</span>;
                    resolve<span class="hljs-constructor">Promise(<span class="hljs-params">_promise</span>, <span class="hljs-params">y</span>, <span class="hljs-params">resolve</span>, <span class="hljs-params">reject</span>)</span>
                &#125;,<span class="hljs-function"> <span class="hljs-params">err</span> =&gt;</span> &#123;
                    <span class="hljs-keyword">if</span> (hasCalled) &#123; return &#125;
                    hasCalled = <span class="hljs-literal">true</span>;
                    reject(err);
                &#125;)
            &#125; <span class="hljs-keyword">else</span> &#123;
                resolve(x)
            &#125;
        &#125; catch(err) &#123;
            <span class="hljs-comment">// 2.3.3.3.4.1</span>
            <span class="hljs-comment">// if resolvePromise or rejectPromise have been called, ignore it.</span>
            <span class="hljs-keyword">if</span> (!hasCalled) &#123;
                reject(err)
            &#125;
        &#125;
        
    &#125; <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-comment">// 2.3.4</span>
        resolve(x);
    &#125;
&#125;</code></pre>

<p>å¦‚æœèƒ½é€šè¿‡ promiseA+ æµ‹è¯•ï¼Œè¯´æ˜è¯¥ç‰ˆæœ¬çš„ Promise ç¬¦åˆè§„èŒƒï¼Œä½†æ˜¯è¿˜ç¼ºå°‘å¸¸ç”¨çš„åŠŸèƒ½ï¼Œç»§ç»­å®Œå–„ï¼š</p>
<ul>
<li>MyPromise.resolve</li>
</ul>
<p>æ¥æ”¶ä¸€ä¸ªå€¼ï¼Œåœ¨å†…éƒ¨åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå°†çŠ¶æ€äº¤ç»™æ–°å®ä¾‹å»å¤„ç†</p>
<pre><code class="hljs arcade">MyPromise.prototype.resolve = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
        resolve(value)
    &#125;)
&#125;</code></pre>

<p>#å‘</p>
<ul>
<li>MyPromise.catch</li>
</ul>
<p>æ¥æ”¶ä¸€ä¸ªæ–¹æ³•ï¼Œåªä¼šåœ¨ rejected çŠ¶æ€ä¸‹æ‰§è¡Œ</p>
<pre><code class="hljs actionscript">MyPromise.prototype.catch = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(callback)</span> </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.then(<span class="hljs-literal">null</span>, callback);
&#125;</code></pre>

<ul>
<li>MyPromise.finally</li>
</ul>
<p>æ¥æ”¶ä¸€ä¸ªæ–¹æ³•ï¼Œä¸è®º fulfilled æˆ–è€… rejected éƒ½ä¼šæ‰§è¡Œ</p>
<pre><code class="hljs actionscript">MyPromise.prototype.finally = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(callback)</span> </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.then(callback, callback);
&#125;</code></pre>

<ul>
<li>MyPromise.all</li>
</ul>
<p>æ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼Œåªæœ‰æ‰€æœ‰é¡¹çš„çŠ¶æ€ä¸º fulfilledï¼Œæœ€ç»ˆç»“æœæ‰ä¸º fulfilledï¼Œå¦‚æœæœ‰ä¸€ä¸ª rejectedï¼Œé‚£ä¹ˆç»“æœå°±æ˜¯ rejected</p>
<pre><code class="hljs typescript">MyPromise.prototype.all = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">promiseArr</span>) </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">let</span> result = [];
        <span class="hljs-keyword">let</span> resolveCount = <span class="hljs-number">0</span>;
        promiseArr.forEach(<span class="hljs-function">(<span class="hljs-params">currentPromise, index</span>) =&gt;</span> &#123;
            currentPromise.then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;
                result[index] = value;
                resolveCount++;
                <span class="hljs-keyword">if</span> (resolveCount === promiseArr.length) &#123;
                    resolve(result);
                &#125;
            &#125;, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;
                reject(err)
            &#125;)
        &#125;)

    &#125;)
&#125;</code></pre>

<ul>
<li>MyPromise.race</li>
</ul>
<p>æ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼Œç»“æœç”±ç¬¬ä¸€ä¸ªçŠ¶æ€æ”¹å˜çš„ thenable å†³å®š</p>
<pre><code class="hljs typescript">MyPromise.prototype.race = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">promiseArr</span>) </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyPromise(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
        promiseArr.forEach(<span class="hljs-function">(<span class="hljs-params">currentPromise, index</span>) =&gt;</span> &#123;
            currentPromise.then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;
                resolve(value);
            &#125;, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;
                reject(err)
            &#125;)
        &#125;)
    &#125;)
&#125;</code></pre>

<ul>
<li>MyPromise.allSettled</li>
</ul>
<p>æ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼Œåªæœ‰ç­‰åˆ°æ‰€æœ‰é¡¹çš„çŠ¶æ€éƒ½æ”¹å˜äº†ï¼Œä¸è®ºæ˜¯ fulfilled è¿˜æ˜¯ rejectedï¼Œéƒ½åªä¼šå˜æˆ fulfilled</p>
<pre><code class="hljs typescript">MyPromise.prototype.allSettled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">promiseArr</span>) </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">let</span> resultArr = [];
        promiseArr.forEach(<span class="hljs-function"><span class="hljs-params">currentPromise</span> =&gt;</span> &#123;
            currentPromise.then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;
                resultArr.push(&#123;status: <span class="hljs-string">'fulfilled'</span>, value: value&#125;);
                <span class="hljs-keyword">if</span> (resultArr.length === promiseArr.length) &#123;
                    resolve(resultArr);
                &#125;
            &#125;, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;
                resultArr.push(&#123;status: <span class="hljs-string">'rejected'</span>, reason: err&#125;);
                <span class="hljs-keyword">if</span> (resultArr.length === promiseArr.length) &#123;
                    resolve(resultArr);
                &#125;
            &#125;)
        &#125;)
    &#125;)
&#125;</code></pre>

<ul>
<li>MyPromise.any</li>
</ul>
<p>æ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœå…¶ä¸­æœ‰ä¸€é¡¹çš„çŠ¶æ€ä¸º fulfilledï¼Œ é‚£ä¹ˆç»“æœå°±æ˜¯ fulfilledï¼Œå¦åˆ™å¦‚æœæ‰€æœ‰éƒ½æ˜¯ rejectedï¼Œé‚£ç»“æœå°±æ˜¯ rejectedï¼Œ å¹¶ä¸” reanson æ˜¯ â€˜AggregateError: All promises were rejectedâ€™</p>
<pre><code class="hljs typescript">MyPromise.prototype.any = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">promiseArr</span>) </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">let</span> rejectCount = <span class="hljs-number">0</span>;
        promiseArr.forEach(<span class="hljs-function"><span class="hljs-params">currentPromise</span> =&gt;</span> &#123;
            currentPromise.then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;
                resolve(value);
            &#125;, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;
                rejectCount ++;
                <span class="hljs-keyword">if</span> (rejectCount === promiseArr.length) &#123;
                    reject(<span class="hljs-string">'AggregateError: All promises were rejected'</span>);
                &#125;
            &#125;)
        &#125;)
    &#125;)
&#125;</code></pre>

<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<p>#å®‰è£… promises-aplus-tests</p>
<pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> i promises-aplus-tests -g</code></pre>

<p>#åœ¨ä»£ç é‡ŒåŠ ä¸Šè¿™æ®µ</p>
<pre><code class="hljs go">MyPromise.deferred = function () &#123;
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">defer</span> = &#123;&#125;;
    <span class="hljs-keyword">defer</span>.promise = <span class="hljs-built_in">new</span> MyPromise((resolve, reject) =&gt; &#123;
        <span class="hljs-keyword">defer</span>.resolve = resolve;
        <span class="hljs-keyword">defer</span>.reject = reject;
    &#125;)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">defer</span>;
&#125;</code></pre>

<p>#æœ€å</p>
<pre><code class="hljs css"><span class="hljs-selector-tag">promises-aplus-tests</span> <span class="hljs-selector-tag">promise</span><span class="hljs-selector-class">.js</span></code></pre>

<p>æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šæˆ‘åœ¨å®ç° promise å†…éƒ¨å¼‚æ­¥æ‰§è¡Œæ—¶é‡‡ç”¨çš„æ˜¯ setTimeoutï¼Œä½†æ˜¯ promise çš„ then æ–¹æ³•æ˜¯ä¸€ä¸ªå¾®ä»»åŠ¡ï¼Œä½† setTimeout æ˜¯ä¸€ä¸ªå®ä»»åŠ¡ï¼Œè¿™ä¸å®é™…æœ‰å‡ºå…¥ã€‚æ‰€ä»¥è¿™é‡Œåªæ˜¯ä½œä¸ºä»£æ›¿ã€‚</p>
<p>å®Œæ•´ä»£ç åœ°å€ï¼š<a href="https://github.com/yuwengCipher/MyPromise" target="_blank" rel="noopener">https://github.com/yuwengCipher/MyPromise</a></p>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/">å¼‚æ­¥ç¼–ç¨‹</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Promise/">Promise</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0åè®®</a> ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2021/04/03/JavaScript%20%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/%E5%BC%84%E6%87%82%20event%20loop/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">å¼„æ‡‚ event loop</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2021/04/01/JavaScript%20%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/%E8%AF%B4%E8%AF%B4%20js%20%E7%9A%84%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6/">
                        <span class="hidden-mobile">è¯´è¯´ js çš„å¼‚æ­¥å¤„ç†æœºåˆ¶</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
              <!-- Comments -->
              <div class="comments" id="comments">
                
                
	<div id="vcomments"></div>
	<script defer src="https://cdn.staticfile.org/valine/1.4.14/Valine.min.js" ></script>

		<script type="text/javascript">
			var oldLoadVa = window.onload;
			window.onload = function () {
				oldLoadVa && oldLoadVa();

				new Valine({
					el: "#vcomments",
					app_id: "FBUJNXRSiPJYpLSHlMBK61Cc-gzGzoHsz",
					app_key: "uSkOsleUpcvIJyb31MudM4dS",
					placeholder: "ç•™ä¸‹ç‚¹è„šå°å§~",
					path: window.location.pathname,
					avatar: "retro",
					meta: ["nick","mail","link"],
					pageSize: "10",
					lang: "zh-CN",
					highlight: false,
					recordIP: false,
					serverURLs: "",
					avatar:'robohash'
				});
			};
		</script>
		<noscript>Please enable JavaScript to view the <a href="https://valine.js.org" target="_blank" rel="nofollow noopener noopener">comments
				powered by Valine.</a></noscript>
		
              </div>
            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <!--
 * @Author: your name
 * @Date: 2020-08-20 09:16:45
 * @LastEditTime: 2021-04-29 15:24:37
 * @LastEditors: your name
 * @Description: In User Settings Edit
 * @FilePath: \blog\themes\fluid\layout\_partial\footer.ejs
-->
<footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <span>DJA</span>
      <i class="iconfont icon-love"></i>
      <span>YZT</span>
    </div>
    
  <div>
    
      <!-- ä¸è’œå­ç»Ÿè®¡PV -->
      
      <span id="busuanzi_container_site_pv" style="display: none">
      æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"></span> æ¬¡
    </span>
    
    
      <!-- ä¸è’œå­ç»Ÿè®¡UV -->
      
      <span id="busuanzi_container_site_uv" style="display: none">
      æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"></span> äºº
    </span>
    
  </div>


      

        
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/main.js" ></script>


  <script  src="/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>





  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




<!-- Plugins -->


  

  

  

  

  

  





  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>














  <script  src="https://cdn.staticfile.org/mermaid/8.5.0/mermaid.min.js" ></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({"theme":"default"});
    }
  </script>




</body>
<div id="dark" onclick="switchDarkMode()"></div>
<script>
  var isNight = new Date().getHours() >= 22 || new Date().getHours() < 7; // æŒ‡å®šæ—¶é—´
  // ä¾æ¬¡åˆ¤æ–­ ç³»ç»Ÿæš—é»‘æ¨¡å¼ æŒ‡å®šæ—¶é—´ ç¼“å­˜ dark
  if( matchMedia('(prefers-color-scheme: dark)').matches || isNight || localStorage.getItem('dark') === '1') {
    if(!(isNight&&localStorage.getItem('noDark') === '1')) {
      document.body.classList.add('dark');
    }
  }
  document.getElementById('dark').innerHTML = document.querySelector("body").classList.contains("dark")?"ğŸŒ™":"ğŸŒ";

  function switchDarkMode() {
	if ($('body').hasClass('dark')) {
		$("#dark").html("ğŸŒ");
		document.body.classList.remove('dark');
		localStorage.setItem('noDark', '1');
		localStorage.setItem('dark', '0');
	} else {
		$("#dark").html("ğŸŒ™"); 
		document.body.classList.add('dark');
		localStorage.setItem('dark', '1');
		localStorage.setItem('noDark', '0');
	}
}
</script>
</html>
